<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Studio de Jeu</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        :root { 
            --bg-soft: #f4f4f2; /* Blanc cass√© moins p√©tant */
            --accent: #2d3436; 
            --border: #dcdcdc;
        }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background: var(--bg-soft); 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        
        /* Barre du haut simplifi√©e */
        header { 
            background: white; 
            padding: 10px 20px; 
            border-bottom: 1px solid var(--border); 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        
        .logo { font-weight: bold; color: var(--accent); margin-right: 15px; }
        input { border: 1px solid var(--border); padding: 8px; border-radius: 4px; outline: none; }
        
        button { 
            background: white; 
            border: 1px solid var(--accent); 
            padding: 8px 15px; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 13px;
            transition: 0.2s;
        }
        button:hover { background: var(--accent); color: white; }
        .btn-run { background: #2ecc71; border-color: #27ae60; color: white; font-weight: bold; }
        .btn-run:hover { background: #27ae60; }

        /* Zone de travail */
        main { flex: 1; position: relative; display: flex; justify-content: center; align-items: center; }

        /* √âditeur flottant (Masqu√© par d√©faut) */
        #editor-wrapper {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            display: none; /* Cach√© au d√©but */
            flex-direction: column;
            width: 400px;
            height: 500px;
            background: white;
            border: 1px solid var(--border);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-radius: 8px;
        }
        textarea { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            resize: none; 
            outline: none; 
            font-family: monospace;
            background: #fafafa;
        }

        /* Container du Jeu */
        #game-container { width: 100%; height: 100%; }
    </style>
</head>
<body>

<header>
    <div class="logo">BUILDER PRO</div>
    <input type="text" id="proj-name" placeholder="Nom du projet">
    <button onclick="toggleEditor()">üìù √âCRIRE LE CODE</button>
    <button onclick="document.getElementById('file-input').click()">üìÅ IMPORTER ASSET</button>
    <button class="btn-run" onclick="runGame()">‚ñ∂ LANCER LE R√âSULTAT</button>
    <input type="file" id="file-input" style="display:none" onchange="handleFileUpload(this)">
</header>

<main>
    <div id="editor-wrapper">
        <div style="padding: 10px; border-bottom: 1px solid var(--border); font-size: 12px; font-weight: bold;">√âDITEUR JS</div>
        <textarea id="code-editor" placeholder="Tapez votre code ici...">// Exemple :
this.add.circle(400, 300, 50, 0x2d3436);</textarea>
    </div>

    <div id="game-container">
        <div id="phaser-app"></div>
    </div>
</main>

<script>
    let game = null;
    let assets = [];

    // Afficher ou masquer l'√©diteur
    function toggleEditor() {
        const ed = document.getElementById('editor-wrapper');
        ed.style.display = (ed.style.display === 'none' || ed.style.display === '') ? 'flex' : 'none';
    }

    function handleFileUpload(input) {
        const file = input.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const name = file.name.split('.')[0].replace(/\s/g, '_');
                assets.push({ name, data: e.target.result, type: file.type });
                alert("Asset '" + name + "' import√© !");
                // On ouvre l'√©diteur pour qu'il puisse coder avec
                document.getElementById('editor-wrapper').style.display = 'flex';
            };
            reader.readAsDataURL(file);
        }
    }

    function runGame() {
        if (game) { game.destroy(true); document.getElementById('phaser-app').innerHTML = ''; }

        const userCode = document.getElementById('code-editor').value;

        const config = {
            type: Phaser.AUTO,
            width: window.innerWidth,
            height: window.innerHeight - 60,
            parent: 'phaser-app',
            backgroundColor: '#f4f4f2',
            scene: {
                preload: function() {
                    assets.forEach(a => {
                        if(a.type.includes('image')) this.load.image(a.name, a.data);
                    });
                },
                create: function() {
                    try {
                        const fn = new Function(userCode);
                        fn.call(this);
                    } catch (e) { console.error(e); }
                }
            }
        };
        game = new Phaser.Game(config);
        // On cache l'√©diteur pour voir le jeu
        document.getElementById('editor-wrapper').style.display = 'none';
    }
</script>

</body>
</html>
