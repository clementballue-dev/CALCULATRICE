<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mon Game Maker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #121212; color: white; }
        
        /* Barre du haut */
        header { background: #202020; padding: 15px; display: flex; gap: 15px; align-items: center; border-bottom: 2px solid #333; }
        input, button { padding: 8px 15px; border-radius: 4px; border: none; font-size: 14px; }
        input { background: #333; color: white; flex-grow: 1; }
        button { cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-run { background: #27ae60; color: white; }
        .btn-save { background: #2980b9; color: white; }
        button:hover { opacity: 0.8; }

        /* Zone Principale */
        #main { display: flex; flex: 1; overflow: hidden; }
        
        /* √âditeur */
        #editor-container { width: 40%; display: flex; flex-direction: column; border-right: 2px solid #333; }
        textarea { flex: 1; background: #1e1e1e; color: #9cdcfe; font-family: 'Consolas', monospace; padding: 15px; resize: none; border: none; outline: none; line-height: 1.5; }

        /* Rendu du jeu */
        #game-view { width: 60%; background: #000; display: flex; flex-direction: column; position: relative; }
        #phaser-app { flex: 1; display: flex; align-items: center; justify-content: center; }
        
        /* Liste des projets sauvegard√©s */
        #project-list { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; max-height: 150px; overflow-y: auto; font-size: 12px; }
    </style>
</head>
<body>

<header>
    <span style="font-weight: bold; color: #e74c3c;">GameMaker JS</span>
    <input type="text" id="project-name" placeholder="Nom de ton nouveau projet...">
    <button class="btn-run" onclick="runGame()">‚ñ∂ VOIR LE R√âSULTAT</button>
    <button class="btn-save" onclick="saveToCloud()">üíæ SAUVEGARDER</button>
</header>

<div id="main">
    <div id="editor-container">
        <textarea id="code-editor" spellcheck="false">// Bienvenue !
// Appuie sur "VOIR LE R√âSULTAT" pour tester.

this.add.text(200, 250, "Mon super jeu !", { fontSize: '40px', fill: '#fff' });

const player = this.add.circle(400, 400, 30, 0x00ff00);
// Tu peux ajouter de la logique ici...</textarea>
    </div>

    <div id="game-view">
        <div id="phaser-app"></div>
        <div id="project-list">
            <strong>Tes projets :</strong>
            <div id="list-items"></div>
        </div>
    </div>
</div>

<script>
    let game = null;

    // --- LOGIQUE DU MOTEUR DE JEU ---
    function runGame() {
        if (game) {
            game.destroy(true);
            document.getElementById('phaser-app').innerHTML = '';
        }

        const userCode = document.getElementById('code-editor').value;
        const config = {
            type: Phaser.AUTO,
            width: 800, height: 600,
            parent: 'phaser-app',
            backgroundColor: '#2d3436',
            scene: {
                create: function() {
                    try {
                        const script = new Function(userCode);
                        script.call(this);
                    } catch (e) {
                        console.error(e);
                        this.add.text(10, 10, "ERREUR CODE: " + e.message, { fill: '#ff0000' });
                    }
                }
            }
        };
        game = new Phaser.Game(config);
    }

    // --- LOGIQUE DE SAUVEGARDE (LocalStorage) ---
    function saveToCloud() {
        const name = document.getElementById('project-name').value;
        const code = document.getElementById('code-editor').value;

        if (!name) return alert("Donne un nom √† ton projet !");

        // On r√©cup√®re la liste existante ou on cr√©e un tableau vide
        let allProjects = JSON.parse(localStorage.getItem('my_games') || "[]");

        // On ajoute le nouveau projet
        const newProject = { name, code, id: Date.now() };
        allProjects.push(newProject);

        // On enregistre tout
        localStorage.setItem('my_games', JSON.stringify(allProjects));
        
        alert("Projet enregistr√© avec succ√®s !");
        updateProjectList();
    }

    function updateProjectList() {
        const listDiv = document.getElementById('list-items');
        const allProjects = JSON.parse(localStorage.getItem('my_games') || "[]");
        
        listDiv.innerHTML = allProjects.map(p => 
            `<div style="margin-top:5px; cursor:pointer; color:#3498db;" onclick="loadProject(${p.id})">üìÅ ${p.name}</div>`
        ).join('');
    }

    function loadProject(id) {
        const allProjects = JSON.parse(localStorage.getItem('my_games') || "[]");
        const p = allProjects.find(item => item.id === id);
        if (p) {
            document.getElementById('project-name').value = p.name;
            document.getElementById('code-editor').value = p.code;
            runGame(); // On lance le projet charg√© automatiquement
        }
    }

    // Charger la liste au d√©marrage
    updateProjectList();
</script>

</body>
</html>
